@startuml
!include style.puml
skinparam ArrowFontStyle plain

title Activity Diagram: View Payment History (fee -v)

|User|
start
:Enter `fee -v s/STUDENT_ID [m/MMYY]`;

|System|
:Parse and validate command format & parameters;

if ("validation fails") then (yes)
  |User|
  :Receive error message;
  stop
else (no)
  |System|
  :Find student by Student ID;

  if ("student not found") then (yes)
    |User|
    :Receive error message;
    stop
  else (no)
    |System|
    :Fetch student's enrolled month;

    if ("enrolled month missing") then (yes)
      |User|
      :Receive error message;
      stop
    else (no)
      |System|
      :Determine requestedStart (input or enrolledMonth);
      :Compute effectiveStart = max(requestedStart, enrolledMonth);
      :Set endMonth = current month;

      if ("effectiveStart > endMonth") then (yes)
        |User|
        :Receive error message;
        stop
      else (no)
        |System|
        :Retrieve map = FeeTracker#getPaymentHistory(student, effectiveStart, endMonth);
        :For each month, attach isExplicit flag (stored status vs default UNPAID);
        :Order entries newest-first (latest month first);
        :Build FeeHistorySummary and update Model (entries, summary);

        |User|
        :Display compiled fee history and success message;
        stop
      endif
    endif
  endif
endif

@enduml